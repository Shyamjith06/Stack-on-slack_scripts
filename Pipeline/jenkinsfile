node {
     
  stage('Git-Checkout') {
   sh 'rm -rf devops-pipeline'
   sh 'git clone -b staging https://devops311@bitbucket.org/accelerators-devops/devops-pipeline.git'
  }
    
 def project_path="devops-pipeline/Ansible"
 
 dir(project_path) {
 stage(' Downloading Jar From Artifactory Locally To Deploy'){
    def server= Artifactory.server 'Artifactory'
    def downloadSpec = """{
    "files": [
    {
      "pattern": "debit-card-application-test/*.war",
      "target": "/var/lib/jenkins/workspace/war-storage-prod/"
      
    }
    ]
    }"""
    server.download(downloadSpec)
    
    
   
}
 stage(' Uploading Jar To Artifactory'){
    def server= Artifactory.server 'Artifactory'
    def downloadSpec = """{
    "files": [
    {
      "pattern": "/var/lib/jenkins/workspace/war-storage-prod/,
      "target": "debit-card-application-staging/$QA_BUILD_NUMBER/"
      }
      ]
      
    }"""
    server.upload(uploadSpec)
}

stage('Deploying To Production') {
sh label: 'Ansible', script: 'ansible-playbook -i inventory -u staging playbook.yml'
}
}
}